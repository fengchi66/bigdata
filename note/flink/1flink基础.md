## 名词

- **任务链**：Flink 将算子的 subtasks *链接*成 *tasks*。每个 task 由一个线程执行。将算子链接成 task 是个有用的优化：它减少线程间切换、缓冲的开销，并且减少延迟的同时增加整体吞吐量。
- **Flink检查点算法**：分布式快照算法，不暂停整个应用，会把生成检查点的过程与处理过程分离。

## Flink检查点

### Flink检查点流程生成流程

- JobManager向每个source任务发送一个新的检查点编号，以此启动检查点流程。
- **source任务**收到消息后，暂停发出记录，生成本地检查点到状态后端，并将检查点分隔符和检查点编号**广播**到下游分区。状态后端保存到检查点后，将JobManager确认消息。source任务之后继续发出记录。
- **barrier对齐**：当任务收到新的检查点分隔符时，会等待其他所有分区都收到这个barrier，在此期间接收到的新数据会缓存起来。
- 任务所有分区收到barrier后执行检查点生成流程，保存到状态后端，并将barrier广播到下游。
- **sink算子**收到barrier后，barrier对齐，将自身状态写入检查点。
- **发生故障时**：从上一次生成的检查点中恢复任务。

### 对性能的影响

- 任务在将其状态存入检查点的过程，处于阻塞状态。由于状态可能很大，写入远程文件系统可能很久。
- rocksdb异步增量检查点。
- 保存点：生成算法和保存点完全一样，由用户显式触发。
