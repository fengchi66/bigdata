## 前言

标签数据开发是用户画像体系搭建中最主要的环节，主要包括离线标签开发、实时类标签开发、用户特征库开发、打通数据服务层等开发内容。

- 离线类标签开发主要围绕前面数据标签体系中提到的统计类、规则类、挖掘类标签展开，这类标签占全部标签的绝大部分；
- 实时类标签主要针对给用户展现实时性较强的场景开发相关数据，如首页新人弹窗、新人红包推送等一些特殊的业务场景；
- 用户特征库围绕用户的关键行为计算相应标签数据，如浏览、搜索、收藏、下单、评论、分析等行为；
- 人群计算在数据服务层之前，业务方通过用户的标签来筛选对应人群，通过人群计算功能组合标签划分出对应的人群，也就是`标签分组`；
- 打通数据服务层将业务方根据业务规则圈定出来的用户推送到不同的业务系统中去

![image-20210614230411048](https://gitee.com/joeyooa/data-images/raw/master/note/2021/image-20210614230411048.png)

## 统计类标签开发

统计类标签是以标签类型来划分的，是指统计用户相关数值、客观描述用户状态的标签。如果从标签的组织维度来看，统计类标签包含了所有维度的标签，如：用户属性、用户行为、用户消费等。如用户性别、年龄、vip等级、注册渠道、累计购买金额、最近30天访问次数等。

userId维度用户标签表：

```sql
CREATE TABLE IF NOT EXISTS user_profile_action_all
(
    user_id STRING COMMENT '用户id',
    value   STRING COMMENT '标签权重'
) 
COMMENT '人口属性维度用户标签表'
PARTITIONED BY
(
    dt      STRING COMMENT '日期分区',
    tag_id  STRING COMMENT '标签id'
);
```

### 近30日购买行为标签

对近30日购买行为这个二级标签进行拆解，可以拆解为：付款订单量(对应标签"ACTION_U_01_001")、总付款金额(对应标签"ACTION_U_01_002")、加购次数("ACTION_U_01_003")这3个标签。

### 最近来访标签

- 从用户浏览行为日志中统计用户`最近一次来访距今天数`

### 开发流程

- 基于hive sql/spark sql对定义好的标签进行统计计算出权重值
- 将计算好的标签插入到userId维度用户标签竖表中

整体来说，统计类标签的开发都非常简单，数仓中写sql计算即可，对程序猿来说那都不是事儿。其实比较重要的是，在设计、开发标签的时候，多从产品的角度去理解标签。比如开发一个近30日购买行为标签的标签，是为了了解用户的消费水平，可以结合其他标签属性对用户做精准投放等。

## 规则类标签开发

规则类标签一般是根据业务运营的需要，在业务层面制定规则的标签。这类标签会带有认为主观判断的因素，所以在开发前需要先进行数据调研，然后根据业务规则开发相应标签。

### 用户价值类标签

#### RFM模型

RFM模型是衡量当前用户价值和客户潜在价值的重要工具和手段。RFM模型由3个基础指标组成：

- 最近一次消费距离现在的时间 (Recency)：这个值越小对我们来说价值越大；
- 某段时间内消费频率次数 (Frequency)：这个值越大越好
- 某段时间内消费金额 (Monetary)：这个值越大越好

基于这3个基础指标进行组合可以划分出8类人群：

| R    | F    | M    | 用户类型     | 备注                                                         |
| ---- | ---- | ---- | ------------ | ------------------------------------------------------------ |
| 高   | 高   | 高   | 重要价值用户 | 交易频繁、交易量大，但长时间没有交易，有流失风险             |
| 低   | 高   | 高   | 重要保持用户 | 交易频繁、交易量大且最近一次交易间隔短，优质客户群           |
| 高   | 低   | 高   | 重要发展用户 | 购买量大，但交易不频繁，可以采用营销手段来吸引               |
| 低   | 低   | 高   | 重要挽留用户 | 最近一次交易时间短、购买金额大，但频率不高，具有很高潜在价值 |
| 高   | 高   | 低   | 一般价值用户 | 购买频率较高，但长时间没有交易且金额较低，已经很难获取更多利润 |
| 低   | 高   | 低   | 一般保持用户 | 活跃用户，但购买能力有限                                     |
| 高   | 低   | 低   | 一般发展用户 | 低价值用户                                                   |
| 低   | 低   | 低   | 一般挽留用户 |                                                              |

