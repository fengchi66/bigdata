`写在前面`

> 用户画像作为当下描述分析用户、运营营销的重要工具，被全部互联网人熟知，用户画像的定义并不复杂，用户画像是指根据用户的基本属性、用户偏好、生活习惯、用户行为等信息而抽象出来的标签化用户模型，是系统通过用户自行上传或埋点上报收集记录了用户大量信息，为便于各业务应用，将这些信息进行沉淀、加工和抽象，形成一个以用户标志为主 key 的标签树，用于全面刻画用户的属性和行为信息，这就是用户画像。

## 认识用户画像 

### 什么是用户画像

**从数据产品功能、运营的角度来说**，用户画像是一个描述用户的工具，刻画出用户个体或者用户群体全方位的特征，为运营分析人员提供用户的偏好、行为等信息进而优化运营策略，为产品提供准确的用户角色信息以便进行针对性的产品设计。

用户画像系统集用户画像的生产与应用于一身，对外（如产品运营、推荐系统等）封装提供用户画像信息，以便对产品更好的设计以及对用户更好的运营。

**从数据开发的角度而言**，**用户画像**，即**用户信息标签化，通过收集用户的社会属性、消费习惯、偏好特征等各个维度的数据，进而对用户或者产品特征属性进行刻画，并对这些特征进行分析、统计，挖掘潜在价值信息，从而抽象出用户的信息全貌**，如图所示，用户画像可看作企业应用大数据的根基，是定向广告投放与个性化推荐的前置条件，为数据驱动运营奠定了基础。由此看来，如何从海量数据中挖掘出有价值的信息越发重要。

![图1-1 某用户标签化](https://camo.githubusercontent.com/92cc0277b2fc7dc7510a95c00bce775fa274b5043c7c7d29281d15ef0d28ed96/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303131393030303831373830302e706e673f2c747970655f5a6d46755a33706f5a57356e6147567064476b2c736861646f775f31302c746578745f6148523063484d364c7939696247396e4c6d4e7a5a473475626d56304c33646c61586870626c38304e444d784f44677a4d413d3d2c73697a655f31362c636f6c6f725f4646464646462c745f3730237069635f63656e746572)

同时，互联网时代已经走过了原来的野蛮增长过程，大家手机上虽然装了很多APP，但可能很多APP是不会打开的。这导致如果APP A想要获取流量，会找APP B把流量给获取过来，而不是因为流量红利的存在，有很多用户会主动安装一些新的APP。所以我们从增量时代，来到了精细化时代。这时，用户画像显得非常重要，如何能够更好的洞察用户意图，理解用户背后隐藏的意图以及对用户标签的洞察，可以很方便的助力整体业务的发展。

用户画像是公司对未来发展的重要基础。用户画像聚集了"上帝"，因为我们做所有的APP都是为用户服务的，希望给用户提供更好的体验。这些"上帝"形成的画像，无形中成为了公司的资产，这在每个公司都是适用的。

### 用户画像与数仓的关系

简单来说，用户画像系统基于基于数仓之上，属于数仓的应用，用户画像标签也都是基于数仓数据来建模的。

![68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303131393030333834343133332e706e673f2c747970655f5a6d46755a33706f5a57356e6147567064476b2c736861646f775f31302c746578745f6148523063484d364c7939696247396e4c6d4e7a5a473475626d56304c](https://gitee.com/joeyooa/data-images/raw/master/note/2021/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303131393030333834343133332e706e673f2c747970655f5a6d46755a33706f5a57356e6147567064476b2c736861646f775f31302c746578745f6148523063484d364c7939696247396e4c6d4e7a5a473475626d56304c.png)

### 用户画像（User Profile）与用户角色（User Persona）区别

经常有人搞不清楚用户画像与用户角色的区别，其实两者本质上是不一样的，先来看看两者的对比图表：

| 对比项   | 用户角色     | 用户画像               |
| -------- | ------------ | ---------------------- |
| 性质     | 定性研究     | 定量研究               |
| 使用时机 | 产品上线前   | 产品上线后             |
| 描述程度 | 精炼概括     | 精细拆分               |
| 用途     | 研究用户体验 | 精准营销，提高用户体验 |

- 性质：用户角色为定性研究，只考虑用户的特征性质不考虑程度，而用户画像是对用户的精细刻画，为定量研究。

- 使用时机：一般来说，用户角色的使用场景在产品上线之前，此时几乎没有任何数据，需要产品同学针对产品的使用方进行特征描绘，以便了解目标群体进行针对性的设计；用户画像的使用场景在产品上线后，此时已积累了一定的数据量，可以对用户进行数据统计构建用户画像，获得精细化运营的能力。

- 描述程度：用户角色是对某个用户群体特征进行高度概括，用户画像是对用户个体或者用户群体的精细描述。

- 用途：用户角色用于辅助产品进行设计，研究用户体验，例如权限控制系统会分为以下几个角色：分析师、产品、运营、数据科学家等角色，用户画像用于了解用户特征以及偏好，以便提供个性化的服务和提高盈利。

### 标签类型

用户画像建模其实就是对用户“**打标签**”，从对用户打标签的方式来看，一般分为3种类型（如图1-3所示）：**①统计类标签；②规则类标签；③机器学习挖掘类标签**。

![68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303131393030343133323836372e706e673f2c747970655f5a6d46755a33706f5a57356e6147567064476b2c736861646f775f31302c746578745f6148523063484d364c7939696247396e4c6d4e7a5a473475626d56304c](https://gitee.com/joeyooa/data-images/raw/master/note/2021/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f32303231303131393030343133323836372e706e673f2c747970655f5a6d46755a33706f5a57356e6147567064476b2c736861646f775f31302c746578745f6148523063484d364c7939696247396e4c6d4e7a5a473475626d56304c.png)

 下面我们介绍这3种类型的标签的区别：

​    **1.统计类标签**

​    **这类标签是最为基础也最为常见的标签类型**，例如，对于某个用户来说，其性别、年龄、城市、星座、近7日活跃时长、近7日活跃天数、近7日活跃次数等字段可以从用户注册数据、用户访问、消费数据中统计得出。**该类标签构成了用户画像的基础**。

​    **2.规则类标签**

​    **该类标签基于用户行为及确定的规则产生**。例如，对平台上“消费活跃”用户这一口径的定义为“近30天交易次数≥2”。在实际开发画像的过程中，由于运营人员对业务更为熟悉，而数据人员对数据的结构、分布、特征更为熟悉，因此**规则类标签的规则由运营人员和数据人员共同协商确定**；

​    **3.机器学习挖掘类标签**

​    **该类标签通过机器学习挖掘产生，用于对用户的某些属性或某些行为进行预测判断**。例如，根据一个用户的行为习惯判断该用户是男性还是女性、根据一个用户的消费习惯判断其对某商品的偏好程度。**该类标签需要通过算法挖掘产生。**

​    **在项目工程实践中，一般统计类和规则类的标签即可以满足应用需求，在开发中占有较大比例。机器学习挖掘类标签多用于预测场景，如判断用户性别、用户购买商品偏好、用户流失意向等。一般地，机器学习标签开发周期较长，开发成本较高，因此其开发所占比例较小**

## 用户画像系统

首先看一下用户画像的系统全貌：

![图片](https://gitee.com/joeyooa/data-images/raw/master/note/2021/640.png)

**① 基础设施**

基础的算力依赖，主要包括：

- 实时依赖。主要是我们自建的数据采集框架和Flink Kafka实施框架。
- 离线依赖。主要采用了spark集群与Hive存储。

**② 数据层**

包括实时流、离线统一数据、第三方数据。这里说一下离线统一数据：

以前更关注的是离线数据，但是当APP越来越多以后，各个端的离线数据口径和埋点是不一致的，有非常大的挑战，特别对于成熟的公司做用户画像时，会发现这一块最耗费精力，因为要对所有的数据口径进行梳理。所以这块未来希望有一套统一的离线数据来支持上层整体的用户画像应用。

**③ 用户理解层**

在数据层上面，再会构建自己的用户理解层，基于数据去理解用户。主要包括行为和标签。

**行为：**

因为有些行为是有强意图的，我们希望把强意图的行为也能够直接积累起来，并在上游直接应用。行为主要包括实时session行为和关键行为。

- 实时session行为：基于session可以挖掘到上游更多的意图，还可以基于session进行线上调整，应用于精细化运营和推荐等。
- 关键行为：需要累积好，对上游的应用或者精细化运营有非常大的应用场景。有业务需要调用时，可以直接复用这种关键行为。基于这种行为以后，我们才会去挖掘标签体系或者挖掘用户画像。

**标签：**

对于标签，主要包含了4类：

- 事实标签：一些更偏事实类的标签，比如用户是什么等级的用户
- 规则标签：就是通过一定的规则计算出来的标签
- 模型标签和实时标签：通过模型挖掘的标签，以及可能服务于具体业务的实时标签。

**④ 服务层**

在用户理解的基础上，我们可以提供各种服务：在线服务YUDS ( 统一收口服务 )、 标签管理 ( 很多标签业务用过以后，下次再用时不知道标签是什么含义了，希望有一套标签元信息的管理，能够很好的管理起来，达成标签的更强复用 )、用户理解平台以及标签质量监控 ( 监控标签的质量，调优标签的结果 )。

## 数据架构

调研了一些各大小公司的用户画像架构，其实用户画像建设可以看做是数仓的一部分。随着最近几年实时计算的兴起，业界主要有两种数仓的工程架构：

- Lambda架构：包括实时层、服务层和离线层
- Kappa架构：没有离线层，所有的数据都是从实时层进行累积，再通过Server层直接出去
- 实时OLAP架构：批流一体的存储，将数据的计算交给OLAP数据库。

以目前数仓建设经验来看，Lambda架构虽然有它的缺点，但确实最稳的方案。

![image-20210605003801880](https://gitee.com/joeyooa/data-images/raw/master/note/2021/image-20210605003801880.png)

- 离线层：我们希望有离线的大数据挖掘能力，因为在线时，发现很多模型类的标签没办法通过在线直接挖掘来。另外，我们希望保证数据回溯。有时标签会改掉一些定义或者手段，我们希望对所有的数据进行重刷，这时在开发架构中，重刷会遇到很大困难，但在Lambda架构，可以比较方便的做整体的重刷。
- 实时层：主要是在工作时建立统一的Logserver，收敛整体数据流的采集，当采集完以后到Kafka做一层规整，由Kafka分别导给实时层、离线层等。在实时数据流中，主要采用的是通过Flink框架来解决实时数据的挖掘。
- 服务层：主要解决统一收敛服务的调用，所有外界的服务调用都统一通过这个调用口进去，这样可以很好地屏蔽上层业务层和底层标签建设，不会影响业务工作。另外，我们还会解决ID转换、性能匹配等工作。
